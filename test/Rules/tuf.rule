#Tuf validation 5.3
validate_root(root):-
    sign($keyid, root, $pub_key, $sig),
    signatures(root, $keyid, $sig).

#Tuf validation 5.3
validate_expiration($file):-
    expires($root, $exp),
    now($root, $time),
    $time < $exp.

#Tuf validation 5.3
validate_version($file):-
    version($root, $ver),
    spec_version($root, $ver).

#Intoto validation 5.2.3
validate_role($file):-
    validate_key($keyid, $pub_key),
    sign($keyid, $file, $pub_key, $sig),
    signatures($file, $keyid, $method, $sig).

validate_key($keyid, $pubkey):-
    validate_root(root),
    keys(root, $keyid),
    keyval($keyid, $prvkey, $pubkey).

validate_threshold($file):-
    threshold(root, $file, $threshold),
    verified($file, $count),
    $count > $threshold.

#Intoto validation 5.2.4 - 5.2.7 is auto generated by the compiler

#Intoto validation 5.2.5 - 5.2.7
validate_materials(extract):-
    products(fetch, $mlists),
    materials(extract, $mlists).

validate_materials(modify):-
    products(extract, $mlists),
    materials(modify, $mlists).

validate_materials(build):-
    products(modify, $mlists),
    materials(build, $mlist).

validate($file):-
    validate_link($file),
    validate_expiration($file),
    validate_threshold($file),
    validate_materials($file).